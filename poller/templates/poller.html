{% extends "base.html" %}
{% block title %}Poller{% endblock %}
{% block extrahead %}
<!-- <meta http-equiv="refresh" content="3"> -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script src="/static/js/qrious.min.js"></script>
{% endblock %}
{% block body %}
<div class="columns is-mobile is-centered">
    <div class="column">
        {% if status == 1 %}
        <canvas id="myChart" width="280px" height="300px"></canvas>
        {% else %}
        <p class="is-size-4 has-text-centered">poll.entropy.energy/{{pollcode}}</p>
        <canvas id="qr"></canvas>
        {% endif %}
    </div>
    <div class="column">
        <div class="mb-4 has-text-centered">
            <p class="heading">Votes</p>
            <p class="title">{{ votes|length }}</p>
        </div>
        <div class="buttons">
            <a class="button is-primary" href="/poller">Refresh</a>
            <a class="button is-link" href="/togglestatus/{{pollcode}}">
                {% if status == 1 %} Hide {% else %} Show {% endif %}</a>
            <a class="button is-warning mt-4" href="/clearvotes/{{pollcode}}">Clear Votes</a>
        </div>

    </div>
</div>
<div>
    <script>
     (function() {
         var qr = new QRious({
             element: document.getElementById('qr'),
             value: 'http://{{host}}/?pollcode={{pollcode}}',
             size: 280,
         });
     })();
    </script>
    <script>
     var ctx = document.getElementById('myChart');
     var myChart = new Chart(ctx, {
         type: 'bar',
         data: {
             labels: {{labels|safe}},
             datasets: [{
                 label: 'Votes',
                 data: {{values|safe}},
                 backgroundColor: 'rgba(81, 151, 214, 1.0)',
                 hoverOffset: 4
             }]
         },

         options: {
             legend: {
                 labels: {
                     // This more specific font property overrides the global property
                     font: {
                         size: 30
                     }
                 }
             }
         }

     });
    </script>
</div>
<div class="section">
    <form method="post" action="/changepoll">
        <div class="field is-horizontal">
            <div class="field-label is-small">
                <label class="label">Poll code</label>
            </div>
            <div class="field-body">
                <div class="field">
                    <div class="control">
                        <input class="input is-small" type="text" placeholder="Numerical code" name="pollcode" value="{{pollcode}}">
                    </div>
                </div>
            </div>
        </div>
        <div class="field is-horizontal">
            <div class="field-label is-small">
                <label class="label">Poll Values</label>
            </div>
            <div class="field-body">
                <div class="field">
                    <div class="control">
                        <input class="input is-small" type="text" placeholder="Space separated values" name="pollvalues" value="{{pollvalues}}">
                    </div>
                </div>
            </div>
        </div>
        <div class="field is-grouped">
            <div class="control">
                <button class="button is-link">Submit</button>
            </div>
            <div class="control">
                <button class="button is-link is-light">Cancel</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}
