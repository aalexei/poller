{% extends "base.html" %}
{% block title %}Poller{% endblock %}
{% block extrahead %}
<!-- <meta http-equiv="refresh" content="3"> -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script src="/static/js/qrious.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
<script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
<style>
 .ct-label {
     font-size: 40px;
 }
</style>
{% endblock %}
{% block menu %}
<a class="navbar-item" href="/poller">
    Refresh
</a>
<hr class="navbar-divider">
<a class="navbar-item" href="/clearvotes/{{pollcode}}">
    Clear votes
</a>
{% endblock %}
{% block body %}
<div class="columns is-mobile is-centered">
    <div class="column">
        <canvas id="qr"></canvas>
        <script>
         (function() {
             var qr = new QRious({
                 element: document.getElementById('qr'),
                 value: 'http://{{host}}/?pollcode={{pollcode}}',
                 size: 300,
             });
         })();
        </script>
    </div>
    <div class="column">
        <p class="subtitle is-4">Poll: {{pollcode}}</p>
        <p class="title is-3">Votes</p>
        <p class="subtitle is-3">{{ votes|length }}</p>
        <div class="buttons">
            <a class="button is-primary" href="/poller">Refresh</a>
        </div>
        <form method="post" action="/changestatus">
            <input type="hidden" name="pollcode" value="{{ pollcode }}">
            <div class="control">
                {% if status == 1 %}
                <input type="hidden" name="status" value="0">
                <button class="button is-link">Hide</button>
                {% else %}
                <input type="hidden" name="status" value="1">
                <button class="button is-link">Show</button>
                {% endif %}
            </div>
        </form>

    </div>
</div>
<div class="box">
    <div class="ct-chart ct-square"></div>
    <script type="text/javascript">

     var data = {
         labels: {{labels|safe}},
         series: {{series|safe}}
     }


     var options = {
         labelInterpolationFnc: function(value) {
             return value[0]
         }
     };

     var responsiveOptions = [
         ['screen and (min-width: 640px)', {
             chartPadding: 30,
             labelOffset: 0,
             labelDirection: 'explode',
             labelInterpolationFnc: function(value) {
                 return value;
             }
         }],
         ['screen and (min-width: 1024px)', {
             labelOffset: 0,
             chartPadding: 20
         }]
     ];

     new Chartist.Pie('.ct-chart', data, options, responsiveOptions);
    </script>

    <canvas id="myChart" width="100%" height="100%"></canvas>
    <script>
     var ctx = document.getElementById('myChart');
     var myChart = new Chart(ctx, {
         type: 'bar',
         data: {
             labels: {{labels|safe}},
             datasets: [{
                 label: '',
                 data: {{series|safe}},
                 backgroundColor: 'rgba(81, 151, 214, 1.0)',
                 hoverOffset: 4
             }]
         },

         options: {
             legend: {
                 labels: {
                     // This more specific font property overrides the global property
                     font: {
                         size: 30
                     }
                 }
             }
         }

     });
    </script>
</div>
<div class="section">
    <form method="post" action="/changepoll">
        <div class="field is-horizontal">
            <div class="field-label is-small">
                <label class="label">Poll code</label>
            </div>
            <div class="field-body">
                <div class="field">
                    <div class="control">
                        <input class="input is-small" type="text" placeholder="Numerical code" name="pollcode" value="{{pollcode}}">
                    </div>
                </div>
            </div>
        </div>
        <div class="field is-horizontal">
            <div class="field-label is-small">
                <label class="label">Poll Values</label>
            </div>
            <div class="field-body">
                <div class="field">
                    <div class="control">
                        <input class="input is-small" type="text" placeholder="Space separated values" name="pollvalues" value="{{pollvalues}}">
                    </div>
                </div>
            </div>
        </div>
        <div class="field is-grouped">
            <div class="control">
                <button class="button is-link">Submit</button>
            </div>
            <div class="control">
                <button class="button is-link is-light">Cancel</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}
